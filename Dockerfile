# ——————————————————————————————
# 🧱 Базовый образ
# ——————————————————————————————
FROM node:18-alpine AS base

# Рабочая директория
WORKDIR /app

# ——————————————————————————————
# 📦 Установка зависимостей
# ——————————————————————————————
COPY package*.json ./
RUN npm ci --omit=dev

# ——————————————————————————————
# 📂 Копируем проект
# ——————————————————————————————
COPY . .

# ——————————————————————————————
# ⚙️ Настройки окружения
# ——————————————————————————————
ENV NODE_ENV=production
ENV PORT=8080
ENV DATA_DIR=/mnt/data

# Railway автоматически монтирует Volume /mnt/data,
# поэтому миксы и вкусы будут сохраняться между перезапусками.

# ——————————————————————————————
# 🚪 Открываем порт и запускаем сервер
# ——————————————————————————————
EXPOSE 8080
CMD ["npm", "start"]
